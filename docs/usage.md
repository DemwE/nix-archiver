# Użycie CLI — nix-archiver

## Globalny argument `--database`

Domyślnie baza danych jest szukana w `./nix-archiver.db`.  
Możesz wskazać inną lokalizację:

```bash
nix-archiver --database /var/lib/nix-archiver/db <komenda>
```

---

## `index` — indeksowanie nixpkgs

Przetwarza historię Git repozytorium nixpkgs i buduje lokalną bazę wersji pakietów.

```bash
nix-archiver index --repo <ścieżka> [opcje]
```

| Opcja | Opis | Domyślnie |
|---|---|---|
| `-r, --repo` | Ścieżka do lokalnego repo nixpkgs | *(wymagane)* |
| `--from` | Commit startowy | `HEAD` |
| `--to-date YYYY-MM-DD` | Zatrzymaj się na tej dacie | — |
| `--to-commit SHA` | Zatrzymaj się na tym commicie | — |
| `-m, --max-commits N` | Maksymalna liczba commitów | — |
| `--full-repo` | Indeksuj całą historię | — |
| `-j, --threads N` | Liczba wątków | liczba CPU |
| `-b, --batch-size N` | Rozmiar wsadu do równoległego przetwarzania | 500 |

### Przykłady

```bash
# Ostatni rok historii
nix-archiver index -r ~/nixpkgs --to-date 2024-01-01

# Tylko 1000 commitów od HEAD
nix-archiver index -r ~/nixpkgs --max-commits 1000

# Cała historia (wolno — może zająć godziny)
nix-archiver index -r ~/nixpkgs --full-repo

# Szybkie — 8 wątków, wsad 1000
nix-archiver index -r ~/nixpkgs --to-date 2024-01-01 -j 8 -b 1000
```

> **Wskazówka:** Sklonuj nixpkgs z `--bare` dla mniejszego rozmiaru:
> ```bash
> git clone --bare https://github.com/NixOS/nixpkgs.git ~/nixpkgs-bare
> ```

---

## `search` — wyszukiwanie pakietów

Przeszukuje bazę. Działa jak [search.nixos.org](https://search.nixos.org/):

- **prefix**: `python` → `python311`, `python314`, …
- **substring** (fallback): `biomejs` → `vscode-extensions.biomejs.biome`
- **case-insensitive** w trybie substring

```bash
# Lista wszystkich wersji (prefix)
nix-archiver search nodejs

# Konkretna wersja
nix-archiver search nodejs 20.11.0

# Rozszerzenia VSCode (substring)
nix-archiver search biomejs
nix-archiver search vscode-extensions

# Tylko major version 20
nix-archiver search nodejs --major 20

# Pattern matching
nix-archiver search python --pattern "3.11.*"

# Od daty
nix-archiver search go --since 2024-01-01

# Wszystkie wyniki (bez limitu)
nix-archiver search python -a

# Limit wyników
nix-archiver search python --limit 100
```

---

## `generate` — generowanie frozen.nix

Czyta plik `packages.nix` z żądanymi wersjami i generuje `frozen.nix` z wyrażeniami `fetchTarball`.

```bash
nix-archiver generate --input packages.nix --output frozen.nix
```

### Format `packages.nix`

```nix
# packages.nix — żądane wersje pakietów
{
  nodejs = "20.11.0";
  python = "3.11.7";
  go = "1.21.5";
}
```

### Wygenerowany `frozen.nix`

```nix
# Generated by nix-archiver
{
  # nodejs v20.11.0 (commit: abc123...)
  nodejs = import (fetchTarball {
    url = "https://github.com/NixOS/nixpkgs/archive/abc123....tar.gz";
    sha256 = "sha256-...";
  }) {};

  # python v3.11.7 (commit: def456...)
  python = import (fetchTarball {
    url = "https://github.com/NixOS/nixpkgs/archive/def456....tar.gz";
    sha256 = "sha256-...";
  }) {};
}
```

---

## `stats` — statystyki bazy

```bash
nix-archiver stats
```

Wyświetla: liczba pakietów, wersji, przetworzonych commitów.
